<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Organigramme de l'Ex√©cutif Fran√ßais</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
    font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
    background:#f5f7fa;
    overflow-x:hidden;
}

#header{
    background:linear-gradient(135deg,#002395 0%,#ED2939 100%);
    padding:20px;
    text-align:center;
    box-shadow:0 2px 10px rgba(0,0,0,.1);
}

#header h1{color:white;font-size:28px;font-weight:700}

#container{
    display:flex;
    padding:20px;
    gap:20px;
    position:relative;
}

/* Colonnes */
#left-column{width:350px;flex-shrink:0;max-height:calc(100vh - 100px);overflow-y:auto}
#middle-column,#right-column{
    flex:1;
    min-height:80vh;
    transition:transform .35s ease;
}

#right-column{flex:.9}

/* Cartes */
.entity-box{
    background:white;
    border-radius:8px;
    padding:15px;
    margin-bottom:15px;
    box-shadow:0 2px 8px rgba(0,0,0,.1);
    display:flex;
    gap:15px;
    align-items:center;
    cursor:pointer;
    position:relative;
    transition:.25s ease;
}

.entity-box:hover{transform:translateX(5px)}

.entity-box.president{
    background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
    color:white;
    cursor:default;
}

.entity-box.pm{
    background:linear-gradient(135deg,#4facfe 0%,#00f2fe 100%);
    color:white;
}

.entity-box.ministre{border-left:4px solid #4facfe}
.entity-box.ministre.active{background:#f0f9ff}

.entity-box.direction{border-left:4px solid #e2e8f0}
.entity-box.direction.active{background:#f9fafb}

.entity-box.service{border-left:4px solid #ED2939}

.photo-box{
    width:60px;
    height:60px;
    border-radius:8px;
    background:#fff;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:26px;
    overflow:hidden;
}

.photo-box img{width:100%;height:100%;object-fit:cover}

.entity-info{flex:1}
.entity-name{font-weight:700}
.entity-function{font-size:13px;opacity:.9}
.entity-budget{font-size:12px;font-weight:600;margin-top:3px}

.info-btn{
    position:absolute;
    top:8px;
    right:8px;
    border:none;
    background:none;
    cursor:pointer;
    font-size:18px;
}

.column-title{
    background:white;
    padding:10px;
    border-radius:8px;
    margin-bottom:15px;
    font-weight:700;
    box-shadow:0 2px 4px rgba(0,0,0,.05);
}

.empty-state{
    text-align:center;
    color:#a0aec0;
    padding:40px 20px;
}

/* Modal */
#modal{
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.5);
    z-index:1000;
    align-items:center;
    justify-content:center;
}

#modal.active{display:flex}

#modal-content{
    background:white;
    padding:30px;
    border-radius:12px;
    width:90%;
    max-width:600px;
    max-height:80vh;
    overflow:auto;
}

#close-modal{
    margin-top:20px;
    padding:10px 20px;
    background:#667eea;
    color:white;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
</style>
</head>

<body>

<div id="header">
<h1>ORGANIGRAMME DE L'EX√âCUTIF FRAN√áAIS</h1>
</div>

<div id="container">
    <div id="left-column"></div>
    <div id="middle-column"><div class="empty-state">‚Üê Cliquez sur un minist√®re</div></div>
    <div id="right-column"><div class="empty-state">‚Üê Cliquez sur une direction</div></div>
</div>

<div id="modal">
    <div id="modal-content">
        <div id="modal-body"></div>
        <button id="close-modal" onclick="closeModal()">Fermer</button>
    </div>
</div>

<script>
/* ====================== DATA ====================== */

const SHEET_ID = '16mks04LSsz58SSdedEhRFBRJNtKd--g7CWt3hnvxtbk';

let orgData={
    president:{nom:"Emmanuel Macron",fonction:"Pr√©sident de la R√©publique",photo:"https://upload.wikimedia.org/wikipedia/commons/4/47/Emmanuel_Macron_-_June_2025_%283x4_cropped%29.jpg"},
    pm:{nom:"S√©bastien Lecornu",fonction:"Premier Ministre",photo:"https://upload.wikimedia.org/wikipedia/commons/3/3d/Portrait_S%C3%A9bastien_Lecornu.jpg"},
    ministeres:[]
};

let activeMinistere=null;
let activeDirection=null;

/* ====================== UTILS ====================== */

function getRelativeTop(el,container){
    return el.getBoundingClientRect().top - container.getBoundingClientRect().top;
}

function parseCSV(text){
    return text.split('\n').map(r=>r.split(','));
}

/* ====================== LOAD ====================== */

async function loadFromGoogleSheets(){
    const urls={
        m:`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=Ministres`,
        d:`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=Directions`,
        s:`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=Services`
    };

    const [m,d,s]=await Promise.all([
        fetch(urls.m).then(r=>r.text()),
        fetch(urls.d).then(r=>r.text()),
        fetch(urls.s).then(r=>r.text())
    ]);

    const M=parseCSV(m).slice(1);
    const D=parseCSV(d).slice(1);
    const S=parseCSV(s).slice(1);

    orgData.ministeres=M.map((r,i)=>({
        nom:r[0],fonction:r[1],photo:r[2]||'üë§',
        ministereId:i,
        directions:D.filter(x=>+x[0]===i).map((x,j)=>({
            nom:x[1],fonction:x[2],photo:x[3]||'üë§',
            directionId:`${i}-${j}`,
            services:S.filter(sv=>sv[0]===`${i}-${j}`).map(sv=>({
                nom:sv[1],fonction:sv[2],photo:sv[3]||'üë§'
            }))
        }))
    }));

    init();
}

/* ====================== RENDER ====================== */

function init(){
    const left=document.getElementById('left-column');
    left.innerHTML='';
    left.append(createBox(orgData.president,'president'));
    left.append(createBox(orgData.pm,'pm'));

    orgData.ministeres.forEach((m,i)=>{
        const box=createBox(m,'ministre');
        box.onclick=e=>selectMinistere(i,e.currentTarget);
        left.append(box);
    });
}

function createBox(e,type){
    const b=document.createElement('div');
    b.className=`entity-box ${type}`;
    b.innerHTML=`
        <div class="photo-box">${e.photo?.startsWith('http')?`<img src="${e.photo}">`:e.photo}</div>
        <div class="entity-info">
            <div class="entity-name">${e.nom}</div>
            <div class="entity-function">${e.fonction}</div>
        </div>`;
    return b;
}

function selectMinistere(i,el){
    activeMinistere=i;activeDirection=null;

    document.querySelectorAll('.ministre').forEach((b,j)=>b.classList.toggle('active',i===j));

    const mid=document.getElementById('middle-column');
    mid.style.transform=`translateY(${getRelativeTop(el,container)}px)`;
    mid.innerHTML='<div class="column-title">Directions</div>';

    orgData.ministeres[i].directions.forEach((d,j)=>{
        const box=createBox(d,'direction');
        box.onclick=e=>selectDirection(j,e.currentTarget);
        mid.append(box);
    });

    document.getElementById('right-column').innerHTML='<div class="empty-state">‚Üê Cliquez sur une direction</div>';
}

function selectDirection(i,el){
    activeDirection=i;

    document.querySelectorAll('.direction').forEach((b,j)=>b.classList.toggle('active',i===j));

    const right=document.getElementById('right-column');
    right.style.transform=`translateY(${getRelativeTop(el,container)}px)`;
    right.innerHTML='<div class="column-title">Services</div>';

    orgData.ministeres[activeMinistere].directions[i].services.forEach(s=>{
        right.append(createBox(s,'service'));
    });
}

/* ====================== MODAL ====================== */

function closeModal(){
    document.getElementById('modal').classList.remove('active');
}

/* ====================== START ====================== */

loadFromGoogleSheets();
</script>

</body>
</html>
